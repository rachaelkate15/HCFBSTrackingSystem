<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/css/uikit.min.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/js/uikit.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/js/uikit-icons.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Lexend+Deca:wght@100..900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="assets/css/uikitMods.css">
    <link rel="stylesheet" type="text/css" href="assets/css/tippyMods.css">
    <link rel = "stylesheet" type = "text/css" href = "https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.css">
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
</head>

<body>

    <div id = "topBar">
        <img id = "logo" src="assets/images/clear logo.png" alt="Humboldt Logo">
        <img id="pfp" style = "cursor:pointer" src="assets/images/pfp_test.jpg" alt="Profile Picture">
        <div uk-dropdown="pos: middle-right; mode: hover">
            <ul class="uk-nav uk-dropdown-nav">
                <li><a href="#" onclick="logOut()">Log Out</a></li>
            </ul>
        </div>
    </div>

    <div class="uk-card uk-card-default uk-card-body uk-box-shadow-large">

        
        <div id = "mainPage" class="uk-card-body">

            <!-- two tabbed interface-->
            <ul class="uk-tab" uk-tab>
                <li onclick = "changeTab('allScholarships')" style = "padding-left:20px;"><a href="#" class="active" id = "allTab">All Scholarships</a></li>
            </ul>

            <div class = "page" id="allScholarships">

            <div class = "innerWriteable" id = "allScholarshipsInner">
            </div>

            

            <div class = "innerToolbar">
                <button id = "createApplicationButton" onclick = "createScholarship()">
                    <i class="ri-add-fill"></i>
                    New Scholarship
                </button>
                <button id = "createAccountButton" onclick = "createAdmin()">
                    <i class="ri-add-fill"></i>
                    New Admin
                </button>
            </div>

            </div>

            <div class = "page" id="myAccount">

            <div class = "innerWriteable" id = "myAccountInner">
            </div>


            </div>  

        </div>
    </div>

        <!-- Application Modal -->
        <div id="scholarshipCreateModal" uk-modal>
            <div class="uk-animation-fade">
                <div class="uk-width-large uk-margin-auto uk-card uk-card-default uk-card-body uk-box-shadow-large" style="    width: 600px;
        margin-top: 0px;">
                    <form>
                        <button class="closeButton" onclick="closeMenu('scholarshipCreateModal')">
                            <i class="ri-close-circle-fill"></i>
                        </button>
                        <h2 style = "    margin: 0px;
                        margin-left: 0px;
                        font-size: 25px;
                        margin-bottom: -10px;
                        " class="uk-text-left">New Scholarship</h2>
                        <hr style = "    border: 2px solid #e9e9e9;"/>

                        <div class="uk-margin">
                            <label class="uk-form-label" for="formScholarshipName">Scholarship Name</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formScholarshipName" type="text" placeholder="Scholarship Name">
                            </div>

                            <label class="uk-form-label" for="formScholarshipDueDate">Due Date</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formScholarshipDueDate" type="date" placeholder="Due Date">
                            </div>

                            <label class="uk-form-label" for="formScholarshipFunderName">Funder Name</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formScholarshipFunderName" type="text" placeholder="Funder Name">
                            </div>

                            <label class="uk-form-label" for="formScholarshipDescription">Description</label>
                            <div class="uk-form-controls">
                                <textarea class="uk-textarea" id="formScholarshipDescription" rows="5"
                                    placeholder="Description"></textarea>
                            </div>

                            <label class="uk-form-label" for="formScholarshipRequirements">Requirements</label>
                            <div class="uk-form-controls">
                                <textarea class="uk-textarea" id="formScholarshipRequirements" rows="5"
                                    placeholder="Requirements"></textarea>
                            </div>

                            <label class="uk-form-label" for="formScholarshipFundsAllocated">Funds Allocated</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formScholarshipFundsAllocated" type="number"
                                    placeholder="Funds Allocated">
                            </div>

    
                        <div class="uk-margin">
                            <button class="uk-button uk-width-1-1" style = "box-shadow:5px 5px 0px #33333350;border-radius:10px;font-size:16px;">
                                <i class="ri-check-fill" style = "margin-right:5px"></i>
                                Create Scholarship
                        </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!--Admin Creation Modal-->
        <div id="adminCreateModal" uk-modal>
            <div class="uk-animation-fade">
                <div class="uk-width-large uk-margin-auto uk-card uk-card-default uk-card-body uk-box-shadow-large" style="    width: 600px;
        margin-top: 0px;">
                    <form>
                        <button class="closeButton" onclick="closeMenu('adminCreateModal')">
                            <i class="ri-close-circle-fill"></i>
                        </button>
                        <h2 style = "    margin: 0px;
                        margin-left: 0px;
                        font-size: 25px;
                        margin-bottom: -10px;
                        " class="uk-text-left">New Admin</h2>
                        <hr style = "    border: 2px solid #e9e9e9;"/>

                        <div class="uk-margin">
                            <label class="uk-form-label" for="formAdminName">First Name</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formAdminName" type="text" placeholder="First Name">
                            </div>

                            <div class="uk-form-controls">
                                <input class="uk-input" id="formAdminLastName" type="text" placeholder="Last Name">
                            </div>

                            <label class="uk-form-label" for="formAdminEmail">Email</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formAdminEmail" type="email" placeholder="Admin Email">
                            </div>

                            <label class="uk-form-label" for="formAdminPassword">Password</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formAdminPassword" type="password" placeholder="Password">
                            </div>

                            <label class="uk-form-label" for="formAdminPasswordConfirm">Confirm Password</label>
                            <div class="uk-form-controls">
                                <input class="uk-input" id="formAdminPasswordConfirm" type="password" placeholder="Confirm Password">
                            </div>
    
                        <div class="uk-margin">
                            <button class="uk-button uk-width-1-1" style = "box-shadow:5px 5px 0px #33333350;border-radius:10px;font-size:16px;">
                                <i class="ri-check-fill" style = "margin-right:5px"></i>
                                Create Admin
                        </button>
                        </div>
                    </form>


</body>

<script src="assets/js/dummyScholarship.js"></script>

<script>

function writeScholarship(
    name, dueDate, funderName, description, fundsAllocated, 
    fundingType, numOfApps, creationDate, endDate, requirements, menu
) {
    const randomID = "id_" + Math.floor(Math.random() * 1000000);
    const fixedDateMonth = dueDate.getMonth() + 1;
    const fixedDateDay = dueDate.getDate();
    const fixedDateYear = dueDate.getFullYear();

    // Generate tooltip content
    const today = new Date();
    const timeDiff = dueDate.getTime() - today.getTime();
    const daysUntilDeadline = Math.ceil(timeDiff / (1000 * 3600 * 24));

    const postedDateMonth = creationDate.getMonth() + 1;
    const postedDateDay = creationDate.getDate();
    const postedDateYear = creationDate.getFullYear();

    // how many days ago was creation date
    var timeDiff2 = today.getTime() - creationDate.getTime();
    var daysSincePosted = Math.ceil(timeDiff2 / (1000 * 3600 * 24));

    // if it was "1 days ago" change to "yesterday"
    if (daysSincePosted === 1) {
        daysSincePosted = 'Posted yesterday';
    } else {
        daysSincePosted = daysSincePosted + ' days ago';
    }

    var formattedMoney = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
    }).format(fundsAllocated);

    const tooltipContent = `
        <p>Full Description</p>
        <h3>${description}</h3>
        <hr>
        <p style = 'margin-top:10px' >Full Requirements</p>
        <h3>${requirements}</h3>
        <hr>
        <p>Quick Info</p>
        <b style = 'opacity:30%' ><i class='ri-price-tag-3-fill'></i></b> <span style = 'opacity:30%'>${name}</span><br>
        <b style = 'opacity:30%' ><i class='ri-hand-coin-fill'></i></b> <span style = 'opacity:30%' >${funderName}</span><br>
        <b><i class='ri-money-dollar-circle-line'></i></b> <span>${formattedMoney}<span><br>
        <b><i class='ri-award-line'></i></b> <span>${fundingType}</span><br>
        <b><i class='ri-group-2-line'></i></b> <span>${numOfApps} applicants</span><br>
        <b><i class='ri-calendar-check-line'></i></b> <span>${postedDateMonth}/${postedDateDay}/${postedDateYear}<span> <span class = 'daysLeft'> ${daysSincePosted}</span><br>
        <b><i class='ri-calendar-schedule-line'></i></b> <span>${fixedDateMonth}/${fixedDateDay}/${fixedDateYear}<span> <span class = 'daysLeft'> ${daysUntilDeadline} days left</span><br>
        <hr style = 'margin-top:10px;margin-bottom:10px'>
        <button class = 'applyButton2' onclick='launchApplyModal(`+randomID+`)'>
        <i class='ri-edit-fill' style = 'margin-right:5px'></i>
        Edit Scholarship   
        </button>
    `;

    const scholarshipHTML = `
    <div id="${randomID}" class="scholarship"
        data-name="${name}" 
        data-dueDate="${fixedDateMonth}/${fixedDateDay}"
        data-funderName="${funderName}" 
        data-description="${description}"
        data-fundsAllocated="${fundsAllocated}" 
        data-fundingType="${fundingType}"
        data-numOfApps="${numOfApps}" 
        data-creationDate="${creationDate}"
        data-endDate="${endDate}" 
        data-requirements="${requirements}"
        data-tippy-content="${tooltipContent}">
        <div class="scholarshipTitle">
            <div class="titleWrapper">
                <h1>${name}</h1>
                <h2>${funderName}</h2>
            </div>
            <h3><i style = "margin-right:5px;" class="ri-calendar-schedule-line"></i> ${fixedDateMonth}/${fixedDateDay}</h3>
        </div>
        <div class="scholarshipMiddle">
            <p>Description</p>
            <div class="scholarshipDesc">
            ${description}
        </div>
    </div>`;

    document.getElementById(`${menu}Inner`).insertAdjacentHTML('beforeend', scholarshipHTML);

    // Initialize Tippy.js on the newly added scholarship after insertion
    setTimeout(() => {
        tippy(`#${randomID}`, {
            allowHTML: true,
            theme: 'innerMenuTheme',
            interactive: true,
            placement: 'right-start',
            intertia: true,
        });
    }, 0);  // Timeout ensures it's applied after the DOM is updated
}

function getScholarshipData(id, menu) {
    const postedScholarship = document.getElementById(id);
    if (!postedScholarship) {
        console.error(`Element with ID ${id} not found.`);
        return;
    }

    const dataMappings = {
        name: "Name",
        creationDate: "Posted",
        funderName: "Funder",
        endDate: "EndDate",
        fundsAllocated: "Amount",
        requirements: "Requirements",
        description: "Description"
    };

    Object.keys(dataMappings).forEach(key => {
        const elemId = `${menu === "myScholarshipsMenu" ? "myScholarship" : "allScholarship"}${dataMappings[key]}`;
        const targetElem = document.getElementById(elemId);
        
        if (targetElem) {
            targetElem.innerHTML = postedScholarship.getAttribute(`data-${key}`) || "N/A";
        } else {
            console.warn(`Element with ID ${elemId} not found.`);
        }
    });

    if (menu === "allScholarshipsMenu") {
        const applyButton = document.getElementById('allApplyButton');
        if (applyButton) {
            applyButton.onclick = function () {
                UIkit.modal(document.getElementById('formSubmissionModal')).show();
                const descElem = document.getElementById('formScholarshipDesc');
                if (descElem) {
                    descElem.innerHTML = `<b style="font-weight:900">Description:</b> ${postedScholarship.getAttribute("data-description") || "N/A"}`;
                }
            };
        } else {
            console.warn("Apply button not found.");
        }
    }

    const menuElem = document.getElementById(menu);
    if (menuElem) {
        menuElem.style.display = "block";
    } else {
        console.warn(`Menu element with ID ${menu} not found.`);
    }
}

    function generateWriteScholarships(menu) {

        for (let i = 0; i < dummyScholarships.length; i++) {
            writeScholarship(
                dummyScholarships[i].name,
                dummyScholarships[i].dueDate,
                dummyScholarships[i].funderName,
                dummyScholarships[i].description,
                dummyScholarships[i].fundsAllocated,
                dummyScholarships[i].fundingType,
                dummyScholarships[i].numOfApps,
                dummyScholarships[i].creationDate,
                dummyScholarships[i].endDate,
                dummyScholarships[i].requirements,
                menu
            );
        }

    }



    function changeTab(tab){
        document.getElementById("allScholarships").style.display = "none";
        document.getElementById("myAccount").style.display = "none";
        document.getElementById(tab).style.display = "flex";

        if(tab == "allScholarships"){
            // add active tab class
            document.getElementById("allTab").classList.add("active");
            document.getElementById("myTab").classList.remove("active");
        }else{
            // add active tab class
            document.getElementById("myTab").classList.add("active");
            document.getElementById("allTab").classList.remove("active");
        }
    }

    function closeMenu(menu){
        console.log(menu);
        document.getElementById(menu).style.display = "none";
    }

    window.onload = function(){
        generateWriteScholarships("allScholarships");
    }
    
    function logOut(){
        localStorage.clear();
        window.location.href = "login.html";
    }

    function createScholarship(){
        UIkit.modal(document.getElementById('scholarshipCreateModal')).show();
    }

    function createAdmin(){
        UIkit.modal(document.getElementById('adminCreateModal')).show();
    }


    </script>

    </html>