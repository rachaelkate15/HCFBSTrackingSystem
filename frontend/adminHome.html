<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.6.22/css/uikit.min.css" />
    <script src ="https://cdnjs.cloudflare.com/ajax/libs/uikit/3.22.0/js/uikit.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&family=Lexend+Deca:wght@100..900&display=swap"
        rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="assets/css/uikitMods.css">
        <link rel="stylesheet" type="text/css" href="assets/css/tippyMods.css">
        <link rel = "stylesheet" type = "text/css" href = "https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.css">
        <script src="https://unpkg.com/@popperjs/core@2"></script>
        <script src="https://unpkg.com/tippy.js@6"></script>
</head>

<body>

    <div id = "topBar">
        <img id = "logo" src="assets/images/clear logo.png" alt="Humboldt Logo">
        <div id = "pfp_container">
        <img id = "pfp" src="assets/images/pfp_test.jpg" alt="Profile Picture" >
        My Profile
        </div>
            <div id = "pfp_dropdown" uk-dropdown="mode: click;pos: bottom-right">
                <h1 id = "pfp_name">Bob boberson</h1>
                <p id = "pfp_email">bob@bob.com</p>
                <hr/>
                <button uk-toggle="target: #editProfileModal" >Edit Profile</button>
                <button onclick = "logOut()" style = "margin-bottom:0px" >Log Out</button>
            </div>
    </div>

    <div class="uk-card uk-card-default uk-card-body uk-box-shadow-large">

        
        <div id = "mainPage" class="uk-card-body">

            <!-- two tabbed interface-->
            <ul class="uk-tab" uk-tab>
                <li onclick = "changeTab('allScholarships')" style = "padding-left:20px;"><a href="#" class="active" id = "allTab">All Scholarships</a></li>
            </ul>

            <div class = "page" id="allScholarships">

            <div class = "innerWriteable" id = "allScholarshipsInner">
            </div>

            

            <div class = "innerToolbar">
                <button id = "createApplicationButton" onclick = "createScholarship()">
                    <i style = "font-weight:100;" class="ri-add-circle-fill"></i>
                    New Scholarship
                </button>
                <button id = "createAccountButton">
                    <i style = "font-weight:100;" class="ri-add-circle-fill"></i>
                    Add Account
                </button>
            </div>

            </div>

            <div class = "page" id="myAccount">

            <div class = "innerWriteable" id = "myAccountInner">
            </div>


            </div>  

        </div>
    </div>


</body>

<script src="assets/js/dummyScholarship.js"></script>

<script>

function writeScholarship(
    name, dueDate, funderName, description, fundsAllocated, 
    fundingType, numOfApps, creationDate, endDate, requirements, menu
) {
    const randomID = "id_" + Math.floor(Math.random() * 1000000);
    const fixedDateMonth = dueDate.getMonth() + 1;
    const fixedDateDay = dueDate.getDate();
    const fixedDateYear = dueDate.getFullYear();

    // Generate tooltip content
    const today = new Date();
    const timeDiff = dueDate.getTime() - today.getTime();
    const daysUntilDeadline = Math.ceil(timeDiff / (1000 * 3600 * 24));

    const postedDateMonth = creationDate.getMonth() + 1;
    const postedDateDay = creationDate.getDate();
    const postedDateYear = creationDate.getFullYear();

    // how many days ago was creation date
    var timeDiff2 = today.getTime() - creationDate.getTime();
    var daysSincePosted = Math.ceil(timeDiff2 / (1000 * 3600 * 24));

    // if it was "1 days ago" change to "yesterday"
    if (daysSincePosted === 1) {
        daysSincePosted = 'Posted yesterday';
    } else {
        daysSincePosted = daysSincePosted + ' days ago';
    }

    var formattedMoney = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
    }).format(fundsAllocated);

    const tooltipContent = `
        <p>Full Description</p>
        <h3>${description}</h3>
        <hr>
        <p style = 'margin-top:10px' >Full Requirements</p>
        <h3>${requirements}</h3>
        <hr>
        <p>Quick Info</p>
        <b style = 'opacity:30%' ><i class='ri-price-tag-3-fill'></i></b> <span style = 'opacity:30%'>${name}</span><br>
        <b style = 'opacity:30%' ><i class='ri-hand-coin-fill'></i></b> <span style = 'opacity:30%' >${funderName}</span><br>
        <b><i class='ri-money-dollar-circle-line'></i></b> <span>${formattedMoney}<span><br>
        <b><i class='ri-award-line'></i></b> <span>${fundingType}</span><br>
        <b><i class='ri-group-2-line'></i></b> <span>${numOfApps} applicants</span><br>
        <b><i class='ri-calendar-check-line'></i></b> <span>${postedDateMonth}/${postedDateDay}/${postedDateYear}<span> <span class = 'daysLeft'> ${daysSincePosted}</span><br>
        <b><i class='ri-calendar-schedule-line'></i></b> <span>${fixedDateMonth}/${fixedDateDay}/${fixedDateYear}<span> <span class = 'daysLeft'> ${daysUntilDeadline} days left</span><br>
        <hr style = 'margin-top:10px;margin-bottom:10px'>
        <button class = 'applyButton2' onclick='launchApplyModal(`+randomID+`)'>
        <i class='ri-external-link-fill' style = 'margin-right:5px'></i>
        Apply Now
        </button>
    `;

    const scholarshipHTML = `
    <div id="${randomID}" class="scholarship"
        data-name="${name}" 
        data-dueDate="${fixedDateMonth}/${fixedDateDay}"
        data-funderName="${funderName}" 
        data-description="${description}"
        data-fundsAllocated="${fundsAllocated}" 
        data-fundingType="${fundingType}"
        data-numOfApps="${numOfApps}" 
        data-creationDate="${creationDate}"
        data-endDate="${endDate}" 
        data-requirements="${requirements}"
        data-tippy-content="${tooltipContent}">
        <div class="scholarshipTitle">
            <div class="titleWrapper">
                <h1>${name}</h1>
                <h2>${funderName}</h2>
            </div>
            <h3><i style = "margin-right:5px;" class="ri-calendar-schedule-line"></i> ${fixedDateMonth}/${fixedDateDay}</h3>
        </div>
        <div class="scholarshipMiddle">
            <p>Requirements</p>
            <div class="scholarshipReq">${requirements}</div>
        </div>
    </div>`;

    document.getElementById(`${menu}Inner`).insertAdjacentHTML('beforeend', scholarshipHTML);

    // Initialize Tippy.js on the newly added scholarship after insertion
    setTimeout(() => {
        tippy(`#${randomID}`, {
            allowHTML: true,
            theme: 'innerMenuTheme',
            interactive: true,
            placement: 'right-start',
            intertia: true,
        });
    }, 0);  // Timeout ensures it's applied after the DOM is updated
}

function getScholarshipData(id, menu) {
    const postedScholarship = document.getElementById(id);
    if (!postedScholarship) {
        console.error(`Element with ID ${id} not found.`);
        return;
    }

    const dataMappings = {
        name: "Name",
        creationDate: "Posted",
        funderName: "Funder",
        endDate: "EndDate",
        fundsAllocated: "Amount",
        requirements: "Requirements",
        description: "Description"
    };

    Object.keys(dataMappings).forEach(key => {
        const elemId = `${menu === "myScholarshipsMenu" ? "myScholarship" : "allScholarship"}${dataMappings[key]}`;
        const targetElem = document.getElementById(elemId);
        
        if (targetElem) {
            targetElem.innerHTML = postedScholarship.getAttribute(`data-${key}`) || "N/A";
        } else {
            console.warn(`Element with ID ${elemId} not found.`);
        }
    });

    if (menu === "allScholarshipsMenu") {
        const applyButton = document.getElementById('allApplyButton');
        if (applyButton) {
            applyButton.onclick = function () {
                UIkit.modal(document.getElementById('formSubmissionModal')).show();
                const descElem = document.getElementById('formScholarshipDesc');
                if (descElem) {
                    descElem.innerHTML = `<b style="font-weight:900">Description:</b> ${postedScholarship.getAttribute("data-description") || "N/A"}`;
                }
            };
        } else {
            console.warn("Apply button not found.");
        }
    }

    const menuElem = document.getElementById(menu);
    if (menuElem) {
        menuElem.style.display = "block";
    } else {
        console.warn(`Menu element with ID ${menu} not found.`);
    }
}

    function generateWriteScholarships(menu) {

        for (let i = 0; i < dummyScholarships.length; i++) {
            writeScholarship(
                dummyScholarships[i].name,
                dummyScholarships[i].dueDate,
                dummyScholarships[i].funderName,
                dummyScholarships[i].description,
                dummyScholarships[i].fundsAllocated,
                dummyScholarships[i].fundingType,
                dummyScholarships[i].numOfApps,
                dummyScholarships[i].creationDate,
                dummyScholarships[i].endDate,
                dummyScholarships[i].requirements,
                menu
            );
        }

    }



    function changeTab(tab){
        document.getElementById("allScholarships").style.display = "none";
        document.getElementById("myAccount").style.display = "none";
        document.getElementById(tab).style.display = "flex";

        if(tab == "allScholarships"){
            // add active tab class
            document.getElementById("allTab").classList.add("active");
            document.getElementById("myTab").classList.remove("active");
        }else{
            // add active tab class
            document.getElementById("myTab").classList.add("active");
            document.getElementById("allTab").classList.remove("active");
        }
    }

    function closeMenu(menu){
        console.log(menu);
        document.getElementById(menu).style.display = "none";
    }

    window.onload = function(){
        generateWriteScholarships("allScholarships");
    }
    
    function logOut(){
        localStorage.clear();
        window.location.href = "login.html";
    }

    function createScholarship(){
        UIkit.modal(document.getElementById('scholarshipCreationModal')).show();
    }


    </script>

    </html>